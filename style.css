# app.py skeleton for Option E (HTML mirroring)

import streamlit as st
import streamlit.components.v1 as components
import requests
from bs4 import BeautifulSoup

st.set_page_config(page_title="MAEGIA Console", layout="wide")

# Minimal CSS loader
from pathlib import Path
if Path("style.css").exists():
    st.markdown(f"<style>{Path('style.css').read_text()}</style>", unsafe_allow_html=True)

# Remote apps
SITES = {
    "game": "https://game.maegia.tv",
    "kragzouy": "https://kragzouy.maegia.tv",
    "oracle": "https://oracle.maegia.tv",
    "pali": "https://pali.maegia.tv",
    "cybermind": "https://cybermind.fr"
}

# HTML mirroring
def fetch_snapshot(url: str) -> str:
    try:
        html = requests.get(url, timeout=5).text
        soup = BeautifulSoup(html, "html.parser")
        for s in soup.find_all("script"):
            s.decompose()
        return str(soup)
    except Exception as e:
        return f"<p style='color:red;'>Erreur snapshot: {e}</p>"

# State
st.session_state.setdefault("node", "cybermind")

# Layout
left, right = st.columns([2,1])

with left:
    st.header("MAEGIA Console â€” Option E")
    snapshot = fetch_snapshot(SITES[st.session_state.node])
    components.html(snapshot, height=800, scrolling=True)

with right:
    st.subheader("Nodes")
    for k,v in SITES.items():
        if st.button(f"Load {k}"):
            st.session_state.node = k
            st.rerun()
